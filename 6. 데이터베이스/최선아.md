# 2. RDBMS의 기본

- 관계형 데이터베이스의 핵심은 테이블의 구성과 관계에 있음

## 테이블의 구성: 필드와 레코드

| 교수 이름 | 과목 이름    | 학생 수 |
| --------- | ------------ | ------- |
| Kim       | 자료구조     | 20      |
| Lee       | 운영체제     | 30      |
| Park      | 컴퓨터구조   | 20      |
| Kim       | 데이터베이스 | 30      |
| Park      | 데이터베이스 | 30      |

- RDBMS 내의 레코드들은 테이블의 형태임

### 필드 타입

- **필드 타입**: 필드의 데이터 유형
- RDMBS의 테이블 필드에는 다양한 데이터 형식(타입), 즉 필드 타입이 저장될 수 있음
- 아래는 MYSQL의 필드 타입임

| 유형        | 타입      | 설명                                                                                                                      |
| ----------- | --------- | ------------------------------------------------------------------------------------------------------------------------- |
| 숫자형      | TINYINT   | 1바이트의 정수(-128 ~ 127)                                                                                                |
|             | SMALLINT  | 2바이트의 정수(-32768 ~ 32767)                                                                                            |
|             | MEDIUMINT | 3바이트의 정수(-8388608 ~ 8388607)                                                                                        |
|             | INT       | 4바이트의 정수(-2147483648 ~ 2147483647)                                                                                  |
|             | BIGINT    | 8바이트의 정수(-9223372036854775808 ~ 9223372036854775807)                                                                |
|             | FLOAT     | 4바이트 부동 소수점 실수                                                                                                  |
|             | DOUBLE    | 8바이트 부동 소수점 실수                                                                                                  |
|             | DECIMAL   | DECIMAL(전체 자릿수, 소수점 자릿수) 형식의 고정 소수점 실수<br>(예: DECIMAL(3,2)는 소수점 이하 2자리인 총 3자릿수의 소수) |
| 문자형      | CHAR      | 고정 길이 문자열                                                                                                          |
|             | VARCHAR   | 가변 길이의 문자열                                                                                                        |
|             | BLOB      | 이미지, 파일과 같은 대량 바이너리 데이터                                                                                  |
|             | TEXT      | 대량 가변 길이 문자열                                                                                                     |
| 날짜/시간형 | DATE      | YYYY-MM-DD 형식의 날짜                                                                                                    |
|             | TIME      | HH:MM:SS 형식의 시간                                                                                                      |
|             | DATETIME  | 8바이트 YYYY-MM-DD HH:MM:SS 형식의 날짜와 시간                                                                            |
|             | TIMESTAMP | 4바이트 YYYY-MM-DD HH:MM:SS 형식의 날짜와 시간                                                                            |
| 기타        | ENUM      | 정해진 값 중 하나(예: 남, 여)                                                                                             |
|             | GEOMETRY  | 지리 정보(예: 좌표 데이터)                                                                                                |
|             | XML       | XML 데이터                                                                                                                |
|             | JSON      | JSON 데이터                                                                                                               |

### 키

- **키**: 테이블 내의 특정 레코드를 식별할 수 있는 필드의 집합
- 키의 용도
  - 각 레코드 식별
  - 테이블 간의 참조
  - 테이블의 접근 속도 향상
- 키의 종류
  - **후보키**
  - 복합키
  - 슈퍼키
  - **기본키**
  - 대체키
  - **외래키**

#### 후보키

- **후보키**: 유일성과 최소성을 모두 만족하는 키
- 테이블의 한 레코드를 식별하기 위한 필드의 '최소' 집합
- 하나 이상의 필드로 구성될 수 있음
- 후보 키에 포함된 필드 중 하나라도 생략하면 레코드를 고유하게 식별할 수 없게 됨
- 후보키는 테이블 내에 하나 이상 존재할 수 있음
- 예를 들어 아래에서 후보키는 '학번', '이메일', '전화번호'

  | 학번    | 이름 | 이메일           | 전화번호      |
  | ------- | ---- | ---------------- | ------------- |
  | 2021001 | Kim  | kim@example.com  | 010-1234-5678 |
  | 2021002 | Lee  | lee@example.com  | 010-2345-3456 |
  | 2021003 | Park | park@example.com | 010-4567-5678 |
  | 2021004 | Kang | kang@example.com | 010-5678-6789 |
  | 2021005 | Choi | choi@example.com | 010-4231-5432 |

#### 복합키

- **복합키**: 두 필드 이상으로 구성된 후보 키
- 예를들어 아래 '성적 테이블' 에서 후보키는 [학번, 과목코드]

| 학번    | 과목 코드 | 학년 | 수강 연도 | 점수 |
| ------- | --------- | ---- | --------- | ---- |
| 2021001 | CS101     | 1    | 2021      | 85   |
| 2021002 | CS101     | 1    | 2021      | 90   |
| 2021003 | CS102     | 1    | 2021      | 75   |
| 2021004 | CS103     | 1    | 2021      | 80   |
| 2021001 | CS102     | 1    | 2021      | 95   |

#### 슈퍼키

- **슈퍼키**: 유일성만 만족하고 최소성은 만족하지 않는 키
- 예를 들어 아래에서 슈퍼키는 [학번, 이름]

  | 학번    | 이름 | 이메일           | 전화번호      |
  | ------- | ---- | ---------------- | ------------- |
  | 2021001 | Kim  | kim@example.com  | 010-1234-5678 |
  | 2021002 | Lee  | lee@example.com  | 010-2345-3456 |
  | 2021003 | Park | park@example.com | 010-4567-5678 |
  | 2021004 | Kang | kang@example.com | 010-5678-6789 |
  | 2021005 | Choi | choi@example.com | 010-4231-5432 |

#### 기본키(Primary Key)

- **기본키**: 한 레코드를 식별하도록 선정되어 테이블당 하나만 존재할 수 있는 키
- 여러 후보 키 중에서 테이블의 레코드를 대표하도록 선택된 키
- 유일성과 최소성 만족하며 값이 반드시 존재함(NULL 값이 없음)
- 여러 필드로 구성된 기본 키도 존재할 수 있음
- 예를 들어 아래 예시에서 후보키 '학번', '이메일', '전화번호' 중 '학번' 필드를 기본 키로 삼을 수 있음

  | 학번    | 이름 | 이메일           | 전화번호      |
  | ------- | ---- | ---------------- | ------------- |
  | 2021001 | Kim  | kim@example.com  | 010-1234-5678 |
  | 2021002 | Lee  | lee@example.com  | 010-2345-3456 |
  | 2021003 | Park | park@example.com | 010-4567-5678 |
  | 2021004 | Kang | kang@example.com | 010-5678-6789 |
  | 2021005 | Choi | choi@example.com | 010-4231-5432 |

#### 대체키

- **대체키**: 기본키가 아닌 후보키

#### 외래키(Foreign Key)

- **외래키**: 다른 테이블의 기본 키를 참조하는 필드로, 테이블 간의 참조 관계를 형성할 때 사용하는 키
- 외래키를 통해 다른 테이블에 연결(참조)이 가능하고, 테이블 간의 관계도 표현할 수 있음
- 예를들어 '학생' 테이블과 '과목' 테이블에서 '학생' 테이블의 '수강 과목' 필드는 '과목' 테이블의 '개설 과목'을 참조하는 외래키로 활용할 수 있음

<img width="563" alt="Image" src="https://github.com/user-attachments/assets/36f6d5f5-bf69-4863-91cd-45a26425e954" />ㅁ

## 테이블의 관계

- 외래 키를 통해 테이블 간 참조가 가능한데, 외래 키를 매개로 하는 테이블간 연관 관계에 여러 종류가 있음
- 일대일 대응 관계, 일대다 대응 관계, 다대다 대응 관계

### 일대일 대응 관계

- 하나의 레코드가 다른 테이블의 레코드 하나에만 대응되는 경우
- 아래 예시에서 한 사람당 오직 하나의 여권만 가질 수 있으므로 일대일 대응 관계

<img width="560" alt="Image" src="https://github.com/user-attachments/assets/12b1d601-81f2-4e55-94be-87b31efd19f8" />

### 일대다 대응 관계

- 하나의 레코드가 다른 테이블의 여러 레코드와 대응될 수 있는 경우
- 아래 예시에서 한 고객은 여러 건의 주문을 할 수 있으므로 일대다 대응 관계

<img width="560" alt="Image" src="https://github.com/user-attachments/assets/16f05960-c3c7-4a9f-bc89-1080b8d4232f" />

### 다대다 대응 관계

- 한 테이블의 여러 레코드가 다른 테이블의 여러 레코드와 대응되는 경우
- 일반적으로 중간 테이블을 수반하고, 중간 테이블에 대한 일대다 대응이 두번 이뤄진 것과 같음
- 예를 들어 아래 예시에서 '사용자' 테이블과 '사용자그룹' 테이블이 '사용자 ID'를 매개로 일대다 관계를 형성하고, '그룹' 테이블과 '사욪아그룹' 테이블의 '그룹 ID'를 매개로 일대다 관계를 형성하기 때문에, 결과적으로 '사용자' 테이블과 '그룹' 테이블 간의 다대다 대응 관계가 형성됨

<img width="563" alt="Image" src="https://github.com/user-attachments/assets/5d17519a-0155-4ff2-a08f-202991a74891" />

## 무결성 제약 조건

- **무결성**: 일관되며 유효한 데이터의 상태
- **무결성 제약 조건**: 데이터베이스에 저장된 데이터의 일관성과 유효성을 유지하기 위해 마땅히 지켜야 하는 조건

### 1. 도메인 제약 조건

- **도메인 제약 조건**: 테이블이 가질 수 있는 필드 타입과 범위에 대한 규칙
- 각 필드 데이터는 원자 값을 가져야 함
- 지정된 필드 타입을 준수해야 함
- 값의 범위나 기본값이 지정되었을 경우 이를 따라야 함
- NULL이 허용되지 않았다면 NULL이 저장되면 안됨
- 이렇듯 조건이 명시된 테이블에서 제약 조건을 위배하는 데이터가 삽입/수정될 경우 '도메인 제약 조건에 위배' 된 것으로 간주함

<img width="557" alt="Image" src="https://github.com/user-attachments/assets/d304f526-2db4-4628-af7f-6b9f9b51614b" />

### 2. 키 제약 조건

- **키 제약 조건**: 레코드를 고유하게 식별할 수 있는 키로 지정된 필드에 중복된 값이 존재해서는 안된다는 제약 조건

### 3. 엔티티 무결성 제약 조건(기본 키 제약 조건)

- **엔티티 무결성 제약 조건**: 기본 키로 지정한 필드는 고유한 값이어야 하며, NULL이 되어서는 안 된다는 규칙

### 4. 참조 무결성 제약 조건(외래 키 제약 조건)

- **참조 무결성 제약 조건**: 외래 키를 통해 다른 테이블을 참조할 때 데이터의 일관성을 지키기 위한 제약 조건
- 외래 키는 참조하는 테이블의 기본키와 같은 값을 갖거나 NULL 값을 가져야 함

<img width="569" alt="Image" src="https://github.com/user-attachments/assets/1f6f4a4e-b52c-4d65-87b3-c668dd431c23" />

(학생 테이블)

| 학번(student_id) | 이름(name) | 동아리\_id(club_id) |
| ---------------- | ---------- | ------------------- |
| 1001             | 김철수     | 101                 |
| 1002             | 이영희     | NULL                |
| 1003             | 박지성     | 102                 |
| 1004             | 최민지     | NULL                |

(동아리 테이블)

| 동아리\_id(club_id) | 동아리명(club_name) |
| ------------------- | ------------------- |
| 101                 | 축구부              |
| 102                 | 댄스부              |
| 103                 | 밴드부              |

### 참조하는 테이블이 삭제/수정되는 경우

<img width="521" alt="Image" src="https://github.com/user-attachments/assets/4136cfaf-2c9e-49cd-9606-c7a199804ed8" />

- 이 경우 RDBMS는 크게 4가지의 동작을 취할 수 있음
- **연산 제한**: 수정/삭제 연산 자체를 거부
- **기본값 설정**: 참조하는 필드를 미리 지정한 기본값으로 설정
- **NULL 값 설정**: 참조하는 필드를 NULL로 설정
- **연쇄 변경**: 참조하는 레코드도 함께 수정/삭제
